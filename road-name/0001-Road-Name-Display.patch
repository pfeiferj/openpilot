From 909769b0fc73aff57e6614908cf8cf1aa8041f24 Mon Sep 17 00:00:00 2001
From: Jacob Pfeifer <jacob@pfeifer.dev>
Date: Fri, 29 Mar 2024 21:53:07 -0400
Subject: [PATCH] Road Name Display

---
 common/params.cc          |  4 ++++
 selfdrive/ui/qt/onroad.cc | 10 ++++++++++
 2 files changed, 14 insertions(+)

diff --git a/common/params.cc b/common/params.cc
index 38d96a30b..28b89983b 100644
--- a/common/params.cc
+++ b/common/params.cc
@@ -207,6 +207,10 @@ std::unordered_map<std::string, uint32_t> keys = {
     {"UpdaterTargetBranch", CLEAR_ON_MANAGER_START},
     {"UpdaterLastFetchTime", PERSISTENT},
     {"Version", PERSISTENT},
+
+    // PFEIFER - RN {{
+    {"RoadName", PERSISTENT},
+    // }} PFEIFER - RN
 };
 
 } // namespace
diff --git a/selfdrive/ui/qt/onroad.cc b/selfdrive/ui/qt/onroad.cc
index 5d562d6e2..2198fc34d 100644
--- a/selfdrive/ui/qt/onroad.cc
+++ b/selfdrive/ui/qt/onroad.cc
@@ -471,6 +471,16 @@ void AnnotatedCameraWidget::drawHud(QPainter &p) {
   p.setFont(InterFont(66));
   drawText(p, rect().center().x(), 290, speedUnit, 200);
 
+  // PFEIFER - RN {{
+  // Referenced from frogpilot: https://github.com/FrogAi/FrogPilot/
+  const QRect currentRect = rect();
+  const QRect statusBarRect(currentRect.left() - 1, currentRect.bottom() - 50, currentRect.width() + 2, 100);
+  const QString roadName =  QString::fromStdString(Params("/dev/shm/params").get("RoadName"));
+  QRect textRect = p.fontMetrics().boundingRect(statusBarRect, Qt::AlignCenter | Qt::TextWordWrap, roadName);
+  textRect.moveBottom(statusBarRect.bottom() - 50);
+  p.drawText(textRect, Qt::AlignCenter | Qt::TextWordWrap, roadName);
+  // }} PFEIFER - RN
+
   p.restore();
 }
 
-- 
2.39.3 (Apple Git-145)

